# Example Secrets Manager Configuration
# This file demonstrates various configuration options

provider: "1password"
vault: "Private"

environments:
  # Development environment
  - name: "development"
    description: "Local development environment"
    secrets:
      - key: "DATABASE_URL"
        source: "app-dev/database_url"
        required: true
        cycleInterval: "30d"
        transform:
          - type: "template"
            params:
              template: "postgresql://{{username}}:{{secret}}@localhost:5432/{{database}}"
              variables:
                username: "dev_user"
                database: "myapp_dev"

      - key: "API_KEY"
        source: "app-dev/api_key"
        required: true
        cycleInterval: "7d"

      - key: "JWT_SECRET"
        source: "app-dev/jwt_secret"
        required: true
        transform:
          - type: "base64"
            params:
              operation: "encode"

      - key: "CONFIG_JSON"
        source: "app-dev/config"
        transform:
          - type: "json"
            params:
              operation: "stringify"
              indent: 2

  # Staging environment inheriting from development
  - name: "staging"
    description: "Staging environment"
    inheritFrom: "development"
    secrets:
      - key: "DATABASE_URL"
        source: "app-staging/database_url"
        required: true
        cycleInterval: "60d"

      - key: "API_KEY"
        source: "app-staging/api_key"
        required: true
        cycleInterval: "14d"

  # Production environment
  - name: "production"
    description: "Production environment"
    secrets:
      - key: "DATABASE_URL"
        source: "app-prod/database_url"
        required: true
        cycleInterval: "90d"

      - key: "API_KEY"
        source: "app-prod/api_key"
        required: true
        cycleInterval: "30d"

      - key: "JWT_SECRET"
        source: "app-prod/jwt_secret"
        required: true
        cycleInterval: "60d"

      - key: "STRIPE_SECRET_KEY"
        source: "app-prod/stripe_secret"
        required: true
        cycleInterval: "180d"

      - key: "AWS_ACCESS_KEY_ID"
        source: "app-prod/aws_access_key"
        required: true
        cycleInterval: "30d"

      - key: "AWS_SECRET_ACCESS_KEY"
        source: "app-prod/aws_secret_key"
        required: true
        cycleInterval: "30d"

  # CI/CD environment
  - name: "ci"
    description: "Continuous Integration environment"
    secrets:
      - key: "DEPLOY_KEY"
        source: "ci-cd/deploy_key"
        required: true
        cycleInterval: "90d"
        transform:
          - type: "base64"
            params:
              operation: "decode"

      - key: "DOCKER_REGISTRY_TOKEN"
        source: "ci-cd/docker_token"
        required: true
        cycleInterval: "30d"

# Secret cycling configuration
cycling:
  enabled: true
  defaultInterval: "30d"

  rules:
    # API keys cycle more frequently
    - pattern: ".*API.*KEY.*"
      interval: "7d"
      strategy: "regenerate"

    # Database credentials cycle less frequently
    - pattern: "DATABASE_.*"
      interval: "90d"
      strategy: "rotate"

    # JWT secrets need regeneration
    - pattern: "JWT_.*"
      interval: "60d"
      strategy: "regenerate"

    # AWS credentials
    - pattern: "AWS_.*"
      interval: "30d"
      strategy: "custom"
      customHandler: "./plugins/aws-cycler.js"

    # CI/CD secrets
    - pattern: ".*DEPLOY.*|.*CI.*"
      interval: "90d"
      strategy: "regenerate"

  # Notifications for cycling events
  notifications:
    webhook: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
    slack: "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK"
    email:
      - "devops@company.com"
      - "security@company.com"

# Plugin configuration
plugins:
  # Built-in injectors
  - name: "env-injector"
    type: "injector"
    path: "built-in"
    config:
      defaultFormat: "env"

  - name: "docker-injector"
    type: "injector"
    path: "built-in"
    config:
      defaultTarget: "compose"

  - name: "kubernetes-injector"
    type: "injector"
    path: "built-in"
    config:
      defaultNamespace: "default"
      applyManifests: false

  # Built-in transformers
  - name: "base64-transformer"
    type: "transformer"
    path: "built-in"

  - name: "json-transformer"
    type: "transformer"
    path: "built-in"

  - name: "template-transformer"
    type: "transformer"
    path: "built-in"

  # Custom plugins
  - name: "custom-validator"
    type: "validator"
    path: "./plugins/custom-validator.js"
    config:
      strictMode: true

  - name: "aws-cycler"
    type: "cycler"
    path: "./plugins/aws-cycler.js"
    config:
      region: "us-east-1"
      rotateAccessKeys: true

# 1Password specific settings
vault: "Private"
connectServer: "https://connect.company.com"
# accessToken can be set here or via OP_ACCESS_TOKEN environment variable